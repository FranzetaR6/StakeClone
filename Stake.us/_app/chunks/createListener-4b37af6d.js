var J=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var w=(e,t,i)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,v=(e,t)=>{for(var i in t||(t={}))Z.call(t,i)&&w(e,i,t[i]);if(I)for(var i of I(t))$.call(t,i)&&w(e,i,t[i]);return e},k=(e,t)=>X(e,Y(t));import{m as _}from"./index-51db5a33.js";import{bE as L,_ as P,R as u,C as tt,b0 as V}from"./vendor-202ba1b8.js";import{s as et,e as j}from"./helpers-70f71db7.js";import{a as C,b as E,d as W}from"./helpers-496c8f42.js";import{n as q}from"./index-a7a6ffa9.js";import{j as M,m as st}from"./index-b069bb96.js";import{b as H}from"./index-1d03818a.js";import{a7 as B,I as U,b as nt}from"./index-239f6385.js";function St({setLastBet:e,removeActiveBet:t,removeDeduction:i,general:f,autobet:r,getGameState:b}){const d=L({bet:(o,s)=>{var l;const n=s.bet||o.bet;return k(v({},n),{identifier:n.identifier||((l=o.bet)==null?void 0:l.identifier)})}}),S=L({bets:(o,s)=>{var h;const n=s.bet||o.bets[o.bets.length];return[...o.bets||[],k(v({},n),{identifier:n.identifier||((h=o.bet)==null?void 0:h.identifier)})]}}),y=L({bets:(o,s)=>[]}),p=()=>{const o=typeof b=="function"?b():{};f.initialState.set(o)},c=()=>{r.initDefaultStrategies()},T=()=>{r.initDefaultAdvancedStrategies()},g=L({bet:()=>null});return{addMultiBetToContext:S,finishMultiBetGame:()=>(o,s)=>{var n;try{const l=s.bet||((n=o.bets)==null?void 0:n[o.bets.length-1]);if(l&&(e(l),_.removeActiveBet(l.id)),o.bets){const h=P.uniqBy(o.bets,A=>A.id);h.forEach(A=>t(A.id));const K=400;h.forEach((A,Q)=>setTimeout(()=>i(A.identifier),Q*K))}}catch{}},addBetToContext:d,finishGame:()=>(o,s)=>{try{const n=s.bet||o.bet;n&&(e(n),_.removeActiveBet(n.id),t(n.id),i(n.identifier))}catch{}},snapshotAutobetInfo:g,setInitialBettingState:p,initAutobetAdvancedStrategies:T,initAutobetDefaultStrategies:c,clearMultiBets:y}}const D={id:"defaultOnWin",type:"bets",on:{type:"every",value:1,betType:"win"},do:{type:"increaseByPercentage",value:0}},N={id:"defaultOnWinReset",type:"bets",on:{type:"every",value:1,betType:"win"},do:{type:"resetAmount",value:0}},R={id:"defaultOnLossReset",type:"bets",on:{type:"every",value:1,betType:"lose"},do:{type:"resetAmount",value:0}},F={id:"defaultStopOnProfit",type:"profit",message:"stopProfitReached",on:{type:"greaterThanOrEqualTo",value:0,profitType:"profit"},do:{type:"stop",value:0}},G={id:"defaultStopOnLoss",type:"profit",message:"stopLossReached",on:{type:"greaterThanOrEqualTo",value:0,profitType:"loss"},do:{type:"stop",value:0}},x={id:"defaultOnLoss",type:"bets",on:{type:"every",value:1,betType:"lose"},do:{type:"increaseByPercentage",value:0}};function O(e){const t=tt(e);return k(v({},t),{resetToInitialValue:()=>t.set(e)})}function gt(e){const t=O(0),i=(e==null?void 0:e.actionOptions)||et,f=v({},e==null?void 0:e.validators),r=(()=>{const a=O([]),m=O(null),o=s=>a.update(n=>n.filter(l=>l.id!==s));return k(v({},a),{add:s=>a.update(n=>[...n,s]),reset:()=>a.set([]),allowedActions:i,editIndex:m,remove:o,move:({position:s,up:n})=>{const l=u(a),h=n?s-1:s+1;l[h]&&([l[h],l[s]]=[l[s],l[h]]),a.set([...l])},save:s=>{a.update(n=>n.map(l=>l.id===s.id?s:l))},setOnWinEnabled:()=>{r.update(s=>C({blocks:s,block:D}).filter(n=>n.id!==N.id))},setOnWinDisabled:()=>{r.update(s=>C({blocks:s,block:N}).filter(n=>n.id!==D.id))},setOnLossEnabled:()=>{r.update(s=>C({blocks:s,block:x}).filter(n=>n.id!==R.id))},setOnLossDisabled:()=>{r.update(s=>C({blocks:s,block:R}).filter(n=>n.id!==x.id))},setOnWinValue:s=>{r.update(n=>E({blocks:n,id:"defaultOnWin",value:+s,blockDefault:D,target:"do"}))},setOnLossValue:s=>{r.update(n=>E({blocks:n,id:"defaultOnLoss",value:+s,blockDefault:x,target:"do"}))},setStopLoss:s=>{+s==0?o("defaultStopOnLoss"):r.update(n=>E({blocks:n,id:"defaultStopOnLoss",value:+s,blockDefault:G,target:"on"}))},setStopProfit:s=>{+s==0?o("defaultStopOnProfit"):r.update(n=>E({blocks:n,id:"defaultStopOnProfit",value:+s,blockDefault:F,target:"on"}))}})})(),b=O([]),d=O(""),S=(()=>{const a=O({time:new Date().getTime(),triggers:[]});return k(v({},a),{setTriggers:m=>{a.set({time:new Date().getTime(),triggers:m})}})})();return{allowedActions:i,validators:f,gamesLeft:t,blocks:r,betHistory:b,currentStrategyLabel:d,blockTriggers:S,saveStrategy:()=>{const a={label:u(d),blocks:u(r),isDefault:!1};M.save(a)},loadStrategy:a=>{const m=u(M).find(o=>o.label===a);m?(d.set(a),r.set(m.blocks)):(d.set(""),r.set([]))},resetState:()=>{t.resetToInitialValue(),r.resetToInitialValue(),b.resetToInitialValue(),d.resetToInitialValue(),S.resetToInitialValue()},initDefaultStrategies:()=>{u(r).some(a=>a.id===N.id||a.id===R.id||a.id===G.id||a.id===F.id)||r.set([N,R])},initDefaultAdvancedStrategies:()=>{r.set(st.blocks),d.set("Martingale")}}}function yt(e){return{entry:()=>{q.autobetStarted.open()},exit:()=>{q.autobetFinished.open(void 0)},resetAutobetState:()=>{e()}}}const z=({autobet:e,general:t,betHistoryTotal:i})=>{const f=u(e.blocks);if(f==null?void 0:f.some(r=>r.id==="defaultStopOnLoss")){const r=f==null?void 0:f.find(d=>(d==null?void 0:d.id)==="defaultStopOnLoss").on.value;return Number(u(t.amount))+i.loss>=r}return!1},Tt=(e,t)=>P.mapValues(t,i=>i*e);function it({getGameState:e,autobet:t,general:i,handler:f}){return b=>new Promise((d,S)=>{const{bet:y,betHistoryTotal:p}=b;if(y&&b.betHistory.length){const c=()=>V("autobetTab.betting.nextBet.stop",u(i.xstate));if(c()===!1){const T=u(i.totalChipsBetAmount),g=Number(u(t.gamesLeft));g!==0&&t.gamesLeft.set(g-1);const a=u(H)[y.currency].available,m=typeof e=="function"?e():{},o=j({blocks:u(t.blocks),betHistoryTotal:p,balance:a,gameState:m,amount:T,initialState:u(i.initialState),actions:t==null?void 0:t.allowedActions});t.blockTriggers.setTriggers(o.triggers),f({blockResults:o,general:i});const s=z({autobet:t,general:i,betHistoryTotal:p}),n=W({blockResults:o,balance:a,gamesLeft:g,potentialStopLoss:s,amount:o.amount});(n||c())&&(i.initialState.set({}),S({stopReason:n}))}}d()})}function ot({autobet:e,general:t,getGameState:i,handler:f}){return b=>new Promise((d,S)=>{try{const{bet:y,betHistoryTotal:p,betHistory:c}=b;if(y&&c.length>0){const T=()=>V("autobetTab.betting.nextBet.stop",u(t.xstate));if(T()===!1){const g=u(t.amount),a=Number(u(e.gamesLeft));a!==0&&e.gamesLeft.set(a-1);const m=typeof i=="function"?i():{},o=u(H)[y.currency].available,s=j({blocks:u(e.blocks),betHistoryTotal:p,balance:o,gameState:m,amount:Number(u(t.amount)),initialState:u(t.initialState),actions:e==null?void 0:e.allowedActions});e.blockTriggers.setTriggers(s.triggers),f({blockResults:s,general:t});const n=z({betHistoryTotal:p,autobet:e,general:t}),l=W({blockResults:s,balance:o,gamesLeft:a,potentialStopLoss:n,amount:Number(g)});(l||T())&&(t.initialState.set({}),S({stopReason:l}))}}d()}catch{}})}function ht(e){const{moduleName:t,services:i}=e,f=t==="baccarat"||t==="roulette";return{requestState:(p,c)=>{if("requestState"in i)return i.requestState(c)},mutationBet:(p,c)=>{if("mutationBet"in i)return i.mutationBet(c)},mutationNext:(p,c)=>{if("mutationNext"in i)return i.mutationNext(c)},mutationCashout:(p,c)=>{if("mutationCashout"in i)return i.mutationCashout(c)},decideOnNextBet:(p,c)=>f?it(e)(p,c):ot(e)(p,c)}}const at=[B.hilo,B.mines,B.blackjack,B.videoPoker,B.crash,B.slotsSamurai,B.dragonTower],vt=({gameName:e,service:t,xstate:i,resetState:f,tab:r})=>{let b;return{subscribe:()=>{var c,T;const d=g=>{b&&b();const a=u(r),m={[g]:"idle"};t.stop(),t.onTransition(o=>{o.changed&&i.set(o.value)}),i.set(m),t.start(m),(a==="automated"||a==="advanced"&&g==="betTab")&&t.send({type:"TO_AUTOBET"}),S&&t.send({type:U()?"FETCH_STATE":"SKIP_REQUEST_STATE"})},S=at.includes(e),y=(T=(c=t==null?void 0:t.machine)==null?void 0:c.config)==null?void 0:T.states,p="rendering"in y?"rendering":"betTab";d(S?"getState":p),U()===!1&&(b=nt.subscribe(g=>{g.type==="firstUserResponse"&&setTimeout(()=>{f(),d(S?"getState":"betTab")},500)}))},unsubscribe:()=>{b&&b(),t.stop()}}};export{St as a,ht as b,gt as c,vt as d,yt as g,Tt as m};
