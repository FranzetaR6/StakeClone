var O=Object.defineProperty,S=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var y=(t,e,n)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,o=(t,e)=>{for(var n in e||(e={}))q.call(e,n)&&y(t,n,e[n]);if(b)for(var n of b(e))N.call(e,n)&&y(t,n,e[n]);return t},a=(t,e)=>S(t,v(e));import{bE as w,R as m,_ as T}from"./vendor-202ba1b8.js";import{b0 as M,p}from"./index-239f6385.js";const P=({history:t,betType:e,value:n})=>{switch(e){case"bet":return t.bets%n==0;case"win":return e===t.streakType?t.wins%n==0:!1;case"lose":return e===t.streakType?t.losses%n==0:!1;default:return!1}},u=(t,e,n)=>{switch(t){case"every":return e%n==0;case"greater than":return e>n;case"greater than or equal to":return e>=n;case"lower than":return e<n;case"lower than or equal to":return e<=n;case"first":return e===n;default:return!1}},f=({history:t,betType:e,value:n,operationType:s})=>e==="bet"?u(s,t.bets,n):t.streakType===e&&u(s,t.streak,n),d=({value:t,history:e,profitType:n,operationType:s,balance:r})=>{switch(n){case"profit":return u(s,e.profit,t);case"loss":return u(s,e.loss,t);case"balance":return u(s,r,t);default:return!1}},k=(t,e)=>t/100*e,D=({amount:t,balance:e})=>t<=e&&t>=0,c=({amount:t,balance:e})=>D({amount:t,balance:e})?{stop:!1,amount:+p(t)}:{stop:!0,message:"newAmountInvalid"},F=({blockResults:t,amount:e})=>{e.set(p(t.amount))},E=(t,e)=>{const n=T.toPairs(e).map(([s,r])=>[s,r*t]);return T.fromPairs(n)},I=({general:t,blockResults:e})=>{const n=Number(e.amount)===Number(m(t.initialState).amount),s={totalChipsBetAmount:Number(m(t.totalChipsBetAmount)),chips:m(t.chips)};if(n){const r=m(t.initialState).chips;t.chips.set(r)}else{const r=e.amount/s.totalChipsBetAmount,l=E(Math.max(0,r),o({},s.chips));t.chips.set(o({},l))}},_={every:P,everyStreakOf:t=>f(a(o({},t),{operationType:"every"})),firstStreakOf:t=>f(a(o({},t),{operationType:"first"})),streakGreaterThan:t=>f(a(o({},t),{operationType:"greater than"})),streakLowerThan:t=>f(a(o({},t),{operationType:"lower than"})),greaterThanOrEqualTo:t=>d(a(o({},t),{operationType:"greater than or equal to"})),lowerThanOrEqualTo:t=>d(a(o({},t),{operationType:"lower than or equal to"})),lowerThan:t=>d(a(o({},t),{operationType:"lower than"})),greaterThan:t=>d(a(o({},t),{operationType:"greater than"}))},z={stop:({amount:t,message:e})=>({stop:!0,message:e||"conditionalBlockCalledStop",amount:t}),resetAmount:t=>{var e;return c(a(o({},t),{amount:Number((e=t==null?void 0:t.initialState)==null?void 0:e.amount)}))},subtractFromAmount:t=>c(a(o({},t),{amount:t.amount-t.value})),addToAmount:t=>c(a(o({},t),{amount:t.amount+t.value})),setAmount:t=>c(a(o({},t),{amount:t.value})),increaseByPercentage:t=>c(a(o({},t),{amount:t.amount+k(t.value,t.amount)})),decreaseByPercentage:t=>c(a(o({},t),{amount:t.amount-k(t.value,t.amount)}))},j=t=>{const{block:e,actions:n}=t;return n[e.do.type](a(o({},t),{value:Number(e.do.value)}))},x=(t,e,n)=>_[t.on.type](o({history:e,balance:n},t.on)),G=({history:t,bet:e})=>{const n=M(e.payoutMultiplier),s=t.balanceDiff+(e.payout-e.amount);return a(o({},t),{bets:t.bets+1,wins:n==="win"?t.wins+1:t.wins,losses:n==="lose"?t.losses+1:t.losses,balanceDiff:s,profit:+p(Math.max(s,0)),loss:+p(s<0?Math.abs(s):0),streakType:n,streak:n===t.streakType?t.streak+1:1})},J=({blocks:t,betHistoryTotal:e,balance:n,gameState:s,amount:r,actions:l,initialState:A})=>{const C={stop:!1,amount:r,triggers:[],message:void 0,gameState:s};return t.reduce((i,h)=>{if(i.stop)return a(o({},i),{triggers:[...i.triggers,"fail"]});if(x(h,e,n)){const H=j({actions:l,block:h,initialState:A,gameState:s,balance:n,amount:i.amount,message:h.message||i.message}),B=T.merge(i,H);return a(o({},B),{triggers:[...i.triggers,"success"]})}return a(o({},i),{triggers:[...i.triggers,"fail"]})},C)},g={bets:0,wins:0,losses:0,streak:0,profit:0,loss:0,balanceDiff:0,streakType:null},K=w({betHistory:(t,e)=>{const{betHistory:n=[]}=t,s=e.bet||t.bet;return s?[...n,s]:n}}),Q=w({betHistoryTotal:(t,e)=>{const n=e.bet||t.bet,{betHistoryTotal:s}=t;return n?G({history:s||g,bet:n}):s}}),U=w({betHistoryTotal:()=>g});export{K as a,I as c,J as e,F as g,k as p,U as r,z as s,Q as t};
